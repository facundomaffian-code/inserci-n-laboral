<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inserción Laboral Argentina</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Consulta la inserción laboral de carreras universitarias en Argentina con buscador inteligente, gráficos y datos actualizados.">

<!-- ADSENSE (AGREGÁ TU CLIENT-ID) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=TU-CODIGO-ADSENSE" crossorigin="anonymous"></script>

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: "Inter", Arial, sans-serif;
        background: #eef2f6;
        margin: 0;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: background 0.4s;
    }
    body.dark { background: #0f141a; color: #f0f0f0; }

    h1 {
        font-size: 30px;
        margin-bottom: 20px;
        opacity: 0;
        animation: fadeIn 0.7s ease forwards;
    }

    @keyframes fadeIn { 
        from {opacity:0; transform:translateY(10px);} 
        to {opacity:1; transform:translateY(0);} 
    }

    .card {
        background: white;
        padding: 35px;
        border-radius: 18px;
        box-shadow: 0 4px 18px rgba(0,0,0,0.12);
        width: 100%;
        max-width: 750px;
        text-align: center;
        transition: 0.3s;
        opacity: 0;
        animation: fadeIn 0.8s ease forwards 0.2s;
        position: relative;
    }
    body.dark .card { background: #1c222b; color: white; }

    input {
        width: 70%;
        padding: 14px;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 17px;
        transition: 0.3s;
    }
    input:focus { border-color: #4a73ff; outline: none; }

    #suggestions {
        width: 70%;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        margin-top: 5px;
        display: none;
        position: absolute;
        z-index: 20;
        text-align: left;
        max-height: 260px;
        overflow-y: auto;
    }
    #suggestions div {
        padding: 12px;
        cursor: pointer;
        transition: 0.2s;
    }
    #suggestions div:hover { background: #e8e8e8; }
    body.dark #suggestions { background: #1c222b; }
    body.dark #suggestions div:hover { background: #2a323d; }

    button {
        background: #4a73ff;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 10px;
    }
    button:hover { background: #2f54d8; }

    .toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #ddd;
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
    }
    body.dark .toggle { background: #333; color: white; }

    .stats { 
        margin-top: 20px; 
        display: flex; 
        gap: 12px; 
        flex-wrap: wrap; 
        justify-content: center; 
    }
    .stat {
        background: rgba(0,0,0,0.05);
        padding: 12px 16px;
        border-radius: 10px;
        font-size: 15px;
    }
    body.dark .stat { background: rgba(255,255,255,0.08); }

    canvas { margin-top: 25px; max-width: 100%; }

    @media(max-width:600px) {
        input, #suggestions { width: 95%; }
        .card { padding: 20px; }
    }
</style>
</head>
<body>

<div class="toggle" onclick="toggleMode()">Modo oscuro</div>

<h1>Inserción Laboral Argentina</h1>

<div class="card">
    <input 
        id="busqueda" 
        placeholder="Escribí una carrera..." 
        oninput="predict()" 
        onkeydown="keyControl(event)"
    >
    <div id="suggestions"></div>
    <button onclick="buscar()">Buscar</button>
    <div id="resultado"></div>
    <canvas id="grafico"></canvas>
</div>

<script>
let allCareers = [];
let selectedIndex = -1;

async function loadData() {
    const res = await fetch('/api/careers');
    allCareers = await res.json();
}
loadData();

function predict() {
    const text = busqueda.value.toLowerCase();
    const box = document.getElementById('suggestions');
    if (!text) { box.style.display = 'none'; return; }

    const filtered = allCareers
        .filter(c => c.carrera.toLowerCase().includes(text))
        .slice(0, 10);

    box.innerHTML = filtered
        .map((c, i) => 
            `<div id="sug-${i}" onclick="selectCareer('${c.carrera}')">
                ${highlight(c.carrera, text)}
            </div>`
        ).join('');

    box.style.display = filtered.length ? 'block' : 'none';
    selectedIndex = -1;
}

function highlight(text, part) {
    const idx = text.toLowerCase().indexOf(part.toLowerCase());
    if (idx === -1) return text;
    return (
        text.substring(0, idx) +
        "<strong>" +
        text.substring(idx, idx + part.length) +
        "</strong>" +
        text.substring(idx + part.length)
    );
}

function keyControl(e) {
    const items = document.querySelectorAll('#suggestions div');
    if (!items.length) return;

    if (e.key === 'ArrowDown') {
        selectedIndex = (selectedIndex + 1) % items.length;
        updateHighlight(items);
    }
    if (e.key === 'ArrowUp') {
        selectedIndex = (selectedIndex - 1 + items.length) % items.length;
        updateHighlight(items);
    }
    if (e.key === 'Enter' && selectedIndex >= 0) {
        items[selectedIndex].click();
    }
}

function updateHighlight(items) {
    items.forEach((el, i) => {
        el.style.background = (i === selectedIndex ? '#d6ddff' : 'white');
    });
}

function selectCareer(name) {
    busqueda.value = name;
    suggestions.style.display = 'none';
    buscar();
}

function buscar() {
    const carrera = busqueda.value.toLowerCase();
    const found = allCareers.find(
        c => c.carrera.toLowerCase() === carrera
    );

    if (!found) {
        resultado.innerHTML = 
            '<div style="color:#d33">Carrera no encontrada</div>';
        return;
    }

    resultado.innerHTML = `
        <h3>${found.carrera}</h3>
        <div class='stats'>
            <div class='stat'>Inserción: 
                <strong>${found.insercion_laboral}%</strong>
            </div>
            <div class='stat'>Salario: 
                <strong>$${found.salario_promedio}</strong>
            </div>
            <div class='stat'>Demanda: 
                <strong>${found.demanda}</strong>
            </div>
            <div class='stat'>Tendencia: 
                <strong>${found.tendencia}</strong>
            </div>
        </div>`;

    drawGraph(found);
}

function drawGraph(c) {
    const ctx = document.getElementById('grafico');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Inserción laboral'],
            datasets: [{
                label: c.carrera,
                data: [c.insercion_laboral]
            }]
        }
    });
}

function toggleMode() {
    document.body.classList.toggle('dark');
}
</script>

</body>
</html>
